"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="d28fd0bb-8c92-5e43-b9f0-4110b9184ab1")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[9787],{779787:(e,t,n)=>{n.r(t),n.d(t,{CommentsSubmitButton:()=>es,ThreadCommentComposer:()=>eu,getUploadErrorMessage:()=>eo});var r=n(104076),l=n(716976),i=n(237420),s=n(951002),o=n(420680),u=n(293422),a=n(326763),d=n(50686);let c=(0,l.memo)(function(e){return(0,r.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,"data-fpl-icon-size":"24",children:(0,r.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",d:"M11.655 5.008q.345-.015.689 0 .06.003.12.01.12.006.24.018l.103.011a7 7 0 0 1 .475.072l.064.011q.145.03.287.063l.044.01q.126.031.252.068l.092.026.19.06.146.05q.078.028.154.058.093.036.185.074l.11.047.184.083.15.075.168.087.098.054q.1.054.197.113.062.038.123.078.08.049.16.101l.1.07.19.135.115.09q.068.052.136.107.087.071.17.145l.097.083q.098.09.192.182l.064.061.354.354a.5.5 0 0 1 .097.143A6.97 6.97 0 0 1 19 12.001v.5l-.013.254a2.497 2.497 0 0 1-4.608 1.065A3 3 0 0 1 12 15a3 3 0 0 1 0-6c.77 0 1.47.292 2 .768V9.5a.5.5 0 0 1 1 0v3a1.5 1.5 0 0 0 2.993.154L18 12.5V12a6 6 0 0 0-11.97-.596q-.009.092-.015.184a6 6 0 0 0 .014 1.007q.039.384.127.76a6 6 0 0 0 1.774 3.052A5.98 5.98 0 0 0 12 18a5.98 5.98 0 0 0 4.243-1.757.5.5 0 0 1 .707.707 6.98 6.98 0 0 1-5.294 2.04q-.096-.004-.191-.013l-.149-.01q-.102-.011-.204-.025l-.142-.019-.232-.039-.092-.016q-.107-.021-.215-.047l-.131-.03-.2-.054-.13-.037-.175-.057-.153-.05-.16-.061-.17-.068-.14-.061-.164-.074-.12-.06a7 7 0 0 1-.214-.11q-.026-.013-.05-.028a7 7 0 0 1-.23-.13q-.05-.03-.1-.063-.24-.15-.471-.32l-.114-.09q-.077-.058-.153-.12l-.113-.097q-.082-.07-.162-.142a7 7 0 0 1-.465-.465q-.07-.078-.137-.158l-.091-.107a7 7 0 0 1-.155-.196l-.051-.068a7 7 0 0 1-.143-.199l-.055-.078a7 7 0 0 1-.29-.477l-.065-.115-.1-.195-.058-.12-.075-.164-.061-.14a7 7 0 0 1-.135-.352l-.05-.148-.046-.143-.05-.177-.045-.165q-.024-.1-.046-.203-.016-.06-.027-.123-.023-.115-.04-.23l-.02-.115-.023-.177-.02-.169a7 7 0 0 1 0-1.368q.012-.116.028-.23.006-.058.014-.115.014-.09.031-.181l.029-.163q.017-.09.039-.177.016-.077.035-.154l.045-.165a7 7 0 0 1 .096-.32l.057-.17.064-.168.064-.162q.036-.087.076-.172l.06-.133q.008-.021.02-.042l.11-.22.028-.052q.031-.058.064-.115.052-.093.106-.183l.087-.138q.045-.074.093-.146.057-.083.116-.165l.087-.122q.035-.048.072-.094.067-.087.136-.17.065-.08.132-.156.095-.108.194-.212.182-.196.379-.375.074-.067.15-.13l.115-.1q.094-.075.19-.147l.072-.057q.1-.074.201-.143l.08-.056q.09-.059.18-.115l.087-.056.073-.044.14-.079.108-.06q.084-.045.17-.086l.15-.076.162-.072.14-.061q.083-.036.17-.068l.16-.06.152-.051q.087-.03.175-.057l.114-.032a7 7 0 0 1 .239-.064l.046-.011q.138-.033.28-.06.045-.01.089-.017l.23-.04.229-.028.098-.011q.12-.012.239-.019zM12 10.001a2 2 0 1 0 0 4 2 2 0 0 0 0-4"})})});var p=n(945437),f=n(812714),m=n(795033),g=n(511570),h=n.n(g),_=n(873304),x=n(883765),y=n(686549),b=n(653899),k=n(140490),v=n(999521),C=n(641518),T=n(361170),E=n(876621),I=n(157869),A=n(192075),D=n(58212),w=n(443192),j=n(139366),S=n(140431),N=n(366535),F=n(434155),M=n(703826),O=n(868768),L=n(692466);function R(e){let t=(0,i.wA)(),{attachments:n}=e,l=e=>{t((0,N.to)({type:M.q,data:{attachments:n,selectedIdx:n.map(e=>e.thumbnailUrl).indexOf(e),onUpdateAltText:s,canEdit:!0}}))},s=(t,r)=>{let l=n[r];return e.fileKey?F.l.put(e.fileKey,l.id,t).then(n=>(200===n.status&&e.onUpdate({...l,altText:t}),n)):Promise.resolve(void 0)};return(0,r.jsx)("div",{className:L.kG,onClick:e.focusComposer,children:n.map(t=>(0,r.jsx)(O.v,{thumbnailUrl:t.thumbnailUrl,altText:(0,A.t)("comments.attachment_thumbnail_alt_text_default"),onClick:l,isUploading:t.isUploading,onDelete:()=>e.onDelete(t)},t.id))})}var P=n(559392),q=n(666388),K=n(198365),U=n(245683),J=n(767825),W=n(819851),G=n(551037),$=n(249586),X=n(76404),z=n(211862),B=n(592726),H=n(174730),Z=n(944350),Y=n(338891),V=n(821359),Q=n(298056),ee=n(349311),et=n(624180),en=n(849894),er=n(744356),el=n(46612);let ei=[];function es(e){let t=(0,A.t)("comments.submit");return(0,r.jsx)(o.K,{recordingKey:C.Pt(e,"submit"),disabled:e.disabled,onClick:e.onClick,"data-tooltip-type":ee.Ib.TEXT,"data-tooltip":t,"aria-label":t,htmlAttributes:{"data-testid":"comments-submit-button"},variant:"primaryCircle",children:(0,r.jsx)(a.G,{})})}let eo=e=>{switch(e.type){case Q.Wn.MAX_UPLOADS_EXCEEDED:return(0,A.t)("comments.upload_error.media_file_maximum",e.params);case Q.Wn.MAX_IMAGE_SIZE_EXCEEDED:case Q.Wn.MAX_VIDEO_SIZE_EXCEEDED:return(0,A.t)("comments.upload_error.media_file_size_limit_MB",e.params);case Q.Wn.INVALID_FILE_TYPE:return(0,A.t)("comments.upload_error.media_file_types");case Q.Wn.DUPLICATE_FILE_UPLOAD:return(0,A.t)("comments.upload_error.already_uploaded_items",e.params);case Q.Wn.FAILED_TO_UPLOAD:return(0,A.t)("comments.upload_error.failed_to_upload",e.params);default:(0,s.xb)(e)}};function eu(e){return(0,r.jsx)(k.u,{label:"ThreadCommentComposer",children:(0,r.jsx)(ea,{...e})})}function ea(e){let[t,n]=l.useState(e.mountInputFocused||e.mountWithButtons||!1),[s,a]=l.useState(!1),g=l.useRef(null),k=l.useRef(null),N=(0,B.iZ)(),F=(0,H.f)("has_opened_comments_modal"),{threadPosition:M,dispatch:O,viewportPositionFromClientPosition:L,setHyperlinkLocation:eu,setHyperlinkEditorRef:ea,editorRef:ed,scrollToBottom:ec}=e,ep=(0,z.q5)(),ef=ep?.key||null,em=(0,i.d4)(e=>e.currentUserOrgId),eg=ep?.teamId,eh=(0,i.d4)(e=>e.orgUsersByOrgId),e_=(0,er.i)(),ex=(0,i.d4)(e=>e.comments.editingComment),ey=(0,W.lg)(),eb=(0,W.HW)(),ek=(0,i.d4)(e=>e.comments.activeDragTarget),ev=l.useCallback(e=>{if(eu&&ea){if(e?.top===0&&e?.bottom===0&&e?.left===0&&e?.right===0&&e?.height===0&&e?.width===0&&k.current){let e=(0,y.E)(k.current.getBoundingClientRect());eu({...e,width:32,top:e.top+12})}else eu(e);ea(ed)}},[eu,ea,ed]),eC=(0,i.Pj)();l.useEffect(()=>{let t=!(0,K.eR)(e.threadId);(0,$.uE)("Comment composer opened",eC.getState(),{isThread:t}),F||eC.dispatch(w.b({has_opened_comments_modal:!0}))},[eC,e.threadId,F]);let eT=(0,i.d4)(e=>e.comments.emojiPicker),eE=l.useCallback(()=>eT?.visible?(eT.onCancel?.(),O(j.RI({visible:!1})),!0):(e.editorRef.current&&e.editorRef.current.handleEscape(),!1),[e.editorRef,eT,O]),eI=l.useCallback(()=>{e.editorRef.current&&e.editorRef.current.onFocus()},[e.editorRef]),eA=()=>{eZ()||e.onSubmit()},eD=e=>{e.preventDefault(),eA()},ew=()=>{!1!==e.onCancel()&&n(!1)},ej=l.useCallback(e=>{ec&&(e?setTimeout(ec,e):ec())},[ec]);(0,b.h)(()=>{e.scrollToBottom&&k.current&&new MutationObserver(e.scrollToBottom).observe(k.current,{childList:!0,subtree:!0})});let eS=()=>{if(!M||!k.current)return;let e=k.current.getBoundingClientRect(),t=L(new T.Mi(e.right,e.top)),n=L(new T.Mi(e.left,e.bottom));O(j.i4({top:t.y-M.y,right:t.x-M.x,bottom:n.y-M.y,left:n.x-M.x,height:e.height,width:e.width}))},eN=C.qP(e.recordingKey,"update",([t,n])=>{n&&!eY(e.messageMeta)&&ej(100),e.updateMessage(t)}),eF=C.qP(e.recordingKey,"emojiPick",t=>{if(e.editorRef&&e.editorRef.current){let n=_.dN.get(t.id);n&&e.editorRef.current.insertEmoji(n),e.dispatch(j.RI({visible:!1}))}}),eM=async()=>{e.dispatch(j.We(await (0,V.fG)("",e.mentionables,ey===Z._Y.DESIGN))),(0,x.sx)("Comment Composer At Mention Clicked",{userId:e.user.id,fileKey:e.fileKey,parentCommentId:e.threadId}),eS(),a(!0),setTimeout(()=>{a(!1)},250),e.editorRef.current?.focus(!1)},eO=e.allowAttachments,{updateAttachment:eL,deleteAttachment:eR}=e,eP=e.attachments?.sort((e,t)=>e.uploadedAt.getTime()-t.uploadedAt.getTime())??ei,[eq,eK]=l.useState(eP.length),[eU,eJ]=l.useState({}),eW=eP.some(e=>e.isUploading),eG=l.useRef(null),e$=l.useCallback(e=>{eK(e=>e-1),eU.hasOwnProperty(e.id)?eR&&eR(e.id,eU[e.id]):eR&&eR(e.id)},[eR,eU]),eX=l.useCallback((e,t)=>{if(e instanceof v.qW){(0,en.MZ)(O,(0,A.t)("check_network_compatibility.error_bell.comment_attachments.message"));return}O(D.F.enqueue({message:eo(e)})),t&&e$(t)},[O,e$]),ez=l.useCallback(t=>{if(!eO||!eL||0===t.length)return;let n=(0,Y.K)(t,eq,S.xS,Q.xp,eX);eK(e=>e+n.length),n.forEach((t,n)=>{if(Q.xp.includes(t.type)){let r=URL.createObjectURL(t),l=new Date;l.setMilliseconds(l.getMilliseconds()+n),(0,S.JZ)(e.recordingKey,eL,eJ,eX,r,t.type,ef,l,t.name||null)}else throw Error("unexpected file type")})},[eO,eL,eq,eX,e.recordingKey,ef]),eB=l.useCallback(e=>()=>{let t=e.current?.files||null;if(null===t||0===t.length)return;let n=Array.from(t);(0,x.sx)("Comment Attachments Selected",{count:n.length,fileTypes:Array.from(n.reduce((e,t)=>(e.add(t.type),e),new Set))}),ez(n),e.current&&(e.current.value="")},[ez]),eH=(0,G.k)(),eZ=()=>e.isDisabled||eW||eY(e.messageMeta)||(0,q.q)(e.messageMeta)||eH,eY=e=>(0,q.I)(e),eV=eZ(),eQ=eY(e.messageMeta)&&(!eO||0===eP.length),e0=(0,m.md)(et.p),e1=eO&&ek===e.recordingKey&&!(0,K.eR)(e.threadId),e2=(0,f.kc)().comments_lexical?J.k:U.iX;return(0,r.jsxs)(E.Y,{className:h()(e.containerClassName||{[el.fP]:!0,[el.U0]:(0,K.eR)(e.threadId),[el.mr]:e1},eQ&&el.Sg),isDragTarget:()=>eO,onTargetDrop:e=>{if(e.files.length>0){let t=Array.from(e.files);(0,x.sx)("Comment Attachments Dropped",{count:t.length,fileTypes:Array.from(t.reduce((e,t)=>(e.add(t.type),e),new Set))}),ez(t)}O(j.uz(null))},onTargetDragEnter:t=>{O(j.uz(e.recordingKey))},onTargetDragLeave:e=>{O(j.uz(null))},forwardedRef:k,"data-testid":e.editingExistingComment?"edit-comment-composer-container":"new-comment-composer-container",children:[(0,r.jsx)(X.$W,{handleEscape:eE,priority:X.KD.EDITING_TEXT_FIELD,children:(0,r.jsx)(e2,{ref:e.editorRef,activeMentionsId:e0,ariaLabel:e.ariaLabel,className:e.editableTypeaheadClassName||el.OX,currentOrgId:em,currentOrgUsers:eh,delegateEscapeHandling:!0,dispatch:e.dispatch,editingComment:ex??void 0,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,editorRef:e.editorRef,editorType:e.editorType,figmaEditorType:ey,hyperlinkLocation:e.hyperlinkLocation,initMention:s,isProtoView:eb,isThreadCommentOverflowMenuOpen:e_,maintainSelectionOnFocus:e.maintainSelectionOnFocus,maxCommentLength:e.maxCommentLength,mentionables:e.mentionables,messageMeta:e.messageMeta,mountInputFocused:e.mountInputFocused,onCancel:ew,onFilePaste:e=>{if(e.length>0){let t=e.map(e=>new File([e],"",{type:e.type}));(0,x.sx)("Comment Attachments Pasted",{count:t.length,fileTypes:Array.from(t.reduce((e,t)=>(e.add(t.type),e),new Set))}),ez(t)}},onFocus:()=>{e.onComposeFocus&&e.onComposeFocus(),!t&&(n(!0),e.onEditStart&&e.onEditStart())},onSubmit:eA,onUpdateTextArea:eS,openFileKey:ef,openFileTeamId:eg,placeholderText:e.placeholderText,readOnly:e.readOnly,setHyperlinkEditorRef:ea,setHyperlinkLocation:ev,setIsEditorFocused:e.setIsEditorFocused,submitOnEnter:e.submitOnEnter??!0,typeahead:e.typeahead,updateMessage:eN,user:N})}),eO&&eL&&eP.length>0&&(0,r.jsx)(R,{attachments:eP,fileKey:ef,onDelete:e$,onUpdate:eL,focusComposer:eI}),(0,r.jsxs)("div",{className:el.o1,children:[!eQ&&(0,r.jsxs)("div",{className:el.xu,children:[P.Y&&(0,r.jsx)(o.K,{onClick:t=>{(0,x.sx)("Emoji Picker Opened");let n=g.current?.getBoundingClientRect();n&&e.dispatch(j.RI({visible:!0,targetRect:n,onPick:t=>{eF(t),e.editorRef.current?.focus()},onCancel:()=>{e.editorRef.current?.focus(),e.dispatch(j.RI({visible:!1}))}}))},ref:g,"data-tooltip-type":ee.Ib.TEXT,"data-tooltip":(0,A.t)("comments.add_emoji"),"aria-label":(0,A.t)("comments.add_emoji"),htmlAttributes:{"data-testid":"emoji-picker-button"},recordingKey:"emojiPicker",disabled:eQ,children:(0,r.jsx)(d.A,{})}),(0,r.jsx)(o.K,{onClick:eM,"data-tooltip-type":ee.Ib.TEXT,"data-tooltip":(0,A.t)("comments.add_mention"),"aria-label":(0,A.t)("comments.add_mention"),disabled:eQ,recordingKey:"mentionButton",children:(0,r.jsx)(c,{})}),eO&&(0,r.jsx)(I.n,{svgAltText:(0,A.t)("comments.upload_images"),isDisabled:eP.length>=S.xS,acceptedFileTypes:Q.xp.join(","),inputRef:eG,inputId:`fileUploadIconInput-${e.recordingKey}`,onFileInputChange:eB,"data-tooltip-type":ee.Ib.TEXT,"data-tooltip":(0,A.t)("comments.upload_images"),children:(0,r.jsx)("span",{"aria-hidden":!0,children:(0,r.jsx)(p.T,{})})})]}),!e.hideSubmitButton&&(e.editingExistingComment?(0,r.jsxs)("div",{className:el.q9,children:[(0,r.jsx)(u.$n,{variant:"secondary",onClick:ew,children:(0,A.tx)("comments.cancel")}),(0,r.jsx)(u.$n,{variant:"primary",onClick:eD,disabled:eV,recordingKey:C.Pt(e,"editSave"),children:e.submitText})]}):(0,r.jsx)(es,{recordingKey:e.recordingKey,onClick:eD,disabled:eV}))]})]})}},767825:(e,t,n)=>{n.d(t,{k:()=>e6});var r=n(104076),l=n(716976),i=n(240803),s=n(601393),o=n(883187),u=n(465428),a=n(723309),d=n(856434),c=n(942942),p=n(816154),f=n(436919),m=n(697872),g=n(120440),h=n(776111),_=n(511570),x=n.n(_),y=n(328341),b=n(675477),k=n(139366),v=n(292308),C=n(17057),T=n(633065),E=n(129215),I=n(321259),A=n(801519),D=n(349311),w=n(763636);class j extends E.k_{static getType(){return"custom-auto-link"}constructor(e,t,n){super(e,t,n),this.editorType=t.editorType}static clone(e){return new j(e.__url,{isUnlinked:e.__isUnlinked,rel:e.__rel,target:e.__target,title:e.__title,editorType:e.editorType},e.__key)}createDOM(e){let t=document.createElement("span");this._setAttributes(t),t.className=w.JM;let n=super.createDOM(e);return t.appendChild(n),t}updateDOM(e,t,n){let r=t.firstChild;return null===r||(e.__url!==this.__url&&this._setAttributes(t),super.updateDOM(e,r,n),!1)}_setAttributes(e){e.setAttribute("data-testid",`implicit-hyperlink-${this.__url}`),e.setAttribute("data-tooltip",D.MW.HYPERLINK_POPUP),e.setAttribute("data-tooltip-can-edit","false"),e.setAttribute("data-tooltip-interactive","true"),e.setAttribute("data-tooltip-precise","true"),e.setAttribute("data-tooltip-show-above","true"),e.setAttribute("data-tooltip-type",D.Ib.SPECIAL),e.setAttribute("data-tooltip-unconstrain-width","true"),e.setAttribute("data-tooltip-url-string",this.__url),e.setAttribute("spellCheck","false")}static importJSON(e){let{url:t,rel:n,target:r,title:l,isUnlinked:i,editorType:s}=e;return S(t,{rel:n,target:r,title:l,isUnlinked:i,editorType:s})}exportJSON(){return{...super.exportJSON(),editorType:this.editorType,type:"custom-auto-link"}}}function S(e,t={}){return(0,A.pT)(new j(e,t))}class N extends A.Ey{static getType(){return"emoji"}static clone(e){return new N(e.__text,e.__shortcode,e.__key)}constructor(e,t,n){super(e,n),this.__shortcode=t}getUnicode(){return this.__text}getShortcode(){return this.__shortcode}createDOM(e){let t=super.createDOM(e);return t.className=g.Ay.classNames(M.emoji)??"",t.setAttribute("spellcheck","false"),t}updateDOM(){return!1}static importJSON(e){let{text:t,shortcode:n}=e;return F(t,n)}exportJSON(){return{...super.exportJSON(),type:"emoji",shortcode:this.__shortcode,version:1}}isSegmented(){return!0}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}isTextEntity(){return!0}}function F(e,t){return new N(e,t)}let M={emoji:{kMv6JI:"x1c6ngcr",$$css:!0}};class O extends E.Db{static getType(){return"custom-link"}constructor(e,t,n){super(e,t,n),this.editorType=t.editorType}static clone(e){return new O(e.__url,{rel:e.__rel,target:e.__target,title:e.__title,editorType:e.editorType},e.__key)}createDOM(e){let t=document.createElement("span");this._setAttributes(t),t.className=w.JM;let n=super.createDOM(e);return t.appendChild(n),t}updateDOM(e,t,n){let r=t.firstChild;return null===r||(e.__url!==this.__url&&this._setAttributes(t),super.updateDOM(e,r,n),!1)}_setAttributes(e){e.setAttribute("data-tooltip",D.MW.HYPERLINK_POPUP),e.setAttribute("data-tooltip-can-edit","true"),e.setAttribute("data-tooltip-entity-key",this.getKey()),e.setAttribute("data-tooltip-interactive","true"),e.setAttribute("data-tooltip-precise","true"),e.setAttribute("data-tooltip-show-above","true"),e.setAttribute("data-tooltip-target-ref-key",this.editorType??""),e.setAttribute("data-tooltip-type",D.Ib.SPECIAL),e.setAttribute("data-tooltip-unconstrain-width","true"),e.setAttribute("data-tooltip-url-string",this.__url),e.setAttribute("spellCheck","false")}static importJSON(e){let{url:t,rel:n,target:r,title:l,editorType:i}=e;return L(t,{rel:n,target:r,title:l,editorType:i})}exportJSON(){return{...super.exportJSON(),editorType:this.editorType,type:"custom-link"}}static importDOM(){return{a:e=>{let t=e.getAttribute("data-tooltip-url-string");return t?{conversion:e=>{var n;return{node:L(t,{rel:(n=e).getAttribute("rel"),target:n.getAttribute("target"),title:n.getAttribute("title")})}},priority:2}:null}}}}function L(e,t={}){return(0,A.pT)(new O(e,t))}function R(e){return e instanceof O}var P=n(812714),q=n(511998);class K extends A.Ey{static getType(){return"mention"}static clone(e){return new K(e.__text,e.__userId,e.__profileId,e.__userAnnotated,e.__userGroupId,e.__userGroup,e.__key)}constructor(e,t,n,r,l,i,s){super(e,s),this.__userId=t,this.__profileId=n,this.__userAnnotated=r,(0,P.kc)().user_groups_at_mentions&&(this.__userGroupId=l,this.__userGroup=i)}static importJSON(e){let{userId:t,profileId:n,userAnnotated:r,text:l,userGroupId:i,userGroup:s}=e;return J({displayText:l,userId:t,profileId:n,userAnnotated:r,userGroupId:(0,P.kc)().user_groups_at_mentions?i:void 0,userGroup:(0,P.kc)().user_groups_at_mentions?s:void 0})}exportJSON(){return{...super.exportJSON(),userId:this.__userId,profileId:this.__profileId,userAnnotated:this.__userAnnotated,userGroupId:(0,P.kc)().user_groups_at_mentions?this.__userGroupId:void 0,userGroup:(0,P.kc)().user_groups_at_mentions?this.__userGroup:void 0,type:"mention"}}createDOM(e){let t=super.createDOM(e);return t.className=w.lE,t.setAttribute("spellcheck","false"),this.__userId&&t.setAttribute("data-mention-user-id",this.__userId),this.__profileId&&t.setAttribute("data-mention-profile-id",this.__profileId),this.__userGroupId&&t.setAttribute("data-mention-user-group-id",this.__userGroupId),t}exportDOM(){let e=document.createElement("a");return e.setAttribute("data-lexical-mention","true"),this.__userId&&e.setAttribute("data-mention-user-id",this.__userId),this.__profileId&&e.setAttribute("data-mention-profile-id",this.__profileId),this.__userGroupId&&e.setAttribute("data-mention-user-group-id",this.__userGroupId),e.textContent=this.__text,{element:e}}static importDOM(){return{a:e=>e.hasAttribute("data-mention-user-id")||e.hasAttribute("data-mention-profile-id")||e.hasAttribute("data-mention-user-group-id")?{conversion:U,priority:3}:null}}isToken(){return!0}isTextEntity(){return!0}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}getUserId(){return this.__userId}getProfileId(){return this.__profileId}getUserAnnotated(){return this.__userAnnotated}getUserGroupId(){return this.__userGroupId}getUserGroup(){return this.__userGroup}getMessageMetaText(){return this.getProfileId()&&this.getDisplayText().startsWith("@")?this.getDisplayText().slice(1):this.getDisplayText()}getDisplayText(){return this.__text}}function U(e){let t=e.getAttribute("data-mention-user-id")??void 0,n=e.getAttribute("data-mention-profile-id")??void 0,r=e.getAttribute("data-mention-user-group-id")??void 0,l=e.textContent??"";return{node:J({displayText:l,userId:t,profileId:n,userAnnotated:t?{id:t,img_url:e.getAttribute("data-tooltip-user-img-url")??"",handle:e.getAttribute("data-tooltip-user-handle")??l}:void 0,userGroupId:r,userGroup:r?{id:r,name:e.getAttribute("data-tooltip-user-group-name")??l,member_count:parseInt(e.getAttribute("data-tooltip-user-group-member-count")??"0"),preview_members:e.getAttribute("data-tooltip-user-group-preview-members")?.split(",")??[],type:q.pR}:void 0})}}function J({displayText:e,userId:t,profileId:n,userAnnotated:r,userGroupId:l,userGroup:i}){let s=new K(e,t,n,r,(0,P.kc)().user_groups_at_mentions?l:void 0,(0,P.kc)().user_groups_at_mentions?i:void 0);return s.setMode("token"),(0,A.pT)(s)}let W={bold:{k63SB2:"x1s688f",$$css:!0},italic:{kKX8nH:"x1k4tb9n",$$css:!0},strikethrough:{kybGjl:"xmqliwb",k1TLXF:null,kMnn75:null,kmVMDM:null,kNySMw:null,$$css:!0},listOl:{kmVPX3:"x1717udv",kg3NbH:null,kuDDbn:null,kE3dHu:null,kP0aTx:null,kpe85a:null,k8WAf4:null,kLKAdn:null,kGO01o:null,kogj98:"x1ghz6dp",kUOVxO:null,keTefX:null,koQZXg:null,k71WvV:null,km5ZXQ:null,kqGvvJ:null,keoZOQ:null,k1K539:null,kpqbRz:"x43c9pm",kH6xsr:"x3yw8vx",$$css:!0},listUl:{kmVPX3:"x1717udv",kg3NbH:null,kuDDbn:null,kE3dHu:null,kP0aTx:null,kpe85a:null,k8WAf4:null,kLKAdn:null,kGO01o:null,kogj98:"x1ghz6dp",kUOVxO:null,keTefX:null,koQZXg:null,k71WvV:null,km5ZXQ:null,kqGvvJ:null,keoZOQ:null,k1K539:null,kpqbRz:"x43c9pm",kH6xsr:"xtaz4m5",$$css:!0},listItem:{koQZXg:"x400o59",keTefX:null,k71WvV:null,$$css:!0}},G={text:{bold:g.Ay.classNames(W.bold),italic:g.Ay.classNames(W.italic),strikethrough:g.Ay.classNames(W.strikethrough)},list:{ol:g.Ay.classNames(W.listOl),ul:g.Ay.classNames(W.listUl),listitem:g.Ay.classNames(W.listItem)}};function $({editorState:e,editorType:t,editable:n}){return{editorState:e,editable:n,namespace:"lexical-editable-typeahead",onError(e){throw e},theme:G,html:{import:{span:()=>({conversion:X,priority:1})}},nodes:[A.Ey,N,K,O,j,{replace:E.Db,with:e=>L(e.__url,{editorType:t}),withKlass:O},{replace:E.k_,with:e=>S(e.__url,{editorType:t}),withKlass:j},I.v5,I.YW]}}function X(e){return{forChild:function(e){let t=e.fontWeight,n=parseInt(t,10),r=e.textDecoration.split(" "),l=isNaN(n)?"bold"===t:n>=600,i=r.includes("line-through"),s="italic"===e.fontStyle;return e=>((0,A.kF)(e)&&(l&&!e.hasFormat("bold")&&e.toggleFormat("bold"),i&&!e.hasFormat("strikethrough")&&e.toggleFormat("strikethrough"),s&&!e.hasFormat("italic")&&e.toggleFormat("italic")),e)}(e.style),node:null}}var z=n(983016),B=n(372868),H=n(750802),Z=n(188154),Y=n(274748),V=n(782059);let Q={b:"bold",i:"italic",s:"strikethrough"};function ee(e){let t=[];return e.read(()=>{let e=(0,A.Ni)();!function(e){let t=e.getChildren();if(1!==t.length)return!1;let n=t[0];return(0,A.bS)(n)&&0===n.getChildren().length}(e)&&e.getChildren().forEach(e=>(function e(t,n){if((0,I.HY)(t)){let r=t.getListType(),l=[];t.getChildren().forEach(t=>{e(t,l)}),en({styles:["number"===r?"ol":"ul"],children:l},n)}else if((0,I.Mz)(t)){let r=[];t.getChildren().forEach(t=>{e(t,r)}),en({children:r},n)}else if((0,A.bS)(t)){let r=n[n.length-1];r&&!el(r)&&en({t:"\n"},n);let l=t.getChildren();l.length?l.forEach(t=>e(t,n)):en({t:""},n)}else if(t instanceof K){let e=t.getUserId(),r=t.getProfileId(),l=t.getUserAnnotated(),i=t.getUserGroupId(),s=t.getUserGroup(),o={};r?(o.profile_id=r,o.t=t.getMessageMetaText()):(0,P.kc)().user_groups_at_mentions&&i&&s?(o.user_group_id=i,o.user_group=s):e&&l&&(o.user_id=e,o.user_annotated=l),en(o,n)}else if(t instanceof N)en({t:t.getShortcode()},n);else if(t instanceof j||R(t)){let e=t.getURL();en({t:(0,H.F)(t.getTextContent())??"",link:e},n)}else if((0,A.kF)(t)){let e=(0,H.F)(t.getTextContent())??"",r=function(e){let t=[];for(let[n,r]of Object.entries(Q))e.hasFormat(r)&&t.push(n);return t}(t),l={t:e};r.length>0&&(l.styles=r),en(l,n)}else(0,A.wH)(t)&&en({t:"\n"},n)})(e,t))}),t}function et(e,t){let n=(0,z.D)({nodes:$({editorState:null,editorType:"headless-editor"}).nodes,onError:e=>{console.error("Error creating Lexical EditorState:",e)}});return n.update(()=>{let n=(0,A.Ni)();n.clear(),function e(t,n,r){let l=(0,Y.lZ)(t),i=r;for(let t of l){if(t.children&&t.children.length>0){let l;if(el(t)){let e=er(t)?"bullet":"number";l=(0,I.DE)(e)}else l=(0,I.i)();r.append(l),e(t.children,n,l),i=r;continue}if((0,A.hV)(i)&&(i=(0,A.lJ)(),r.append(i)),t.user_annotated||t.profile_id||t.user_group_id)(function(e,t){let n;let r=(0,H.F)(e.t)??"";if(e.profile_id){let t=r.startsWith("@")?r:`@${r}`;n=J({profileId:e.profile_id,displayText:t})}else if(e.user_id&&e.user_annotated){let t=(0,H.F)(e.user_annotated.handle)??"";n=J({userId:e.user_id,userAnnotated:e.user_annotated,displayText:t})}else if((0,P.kc)().user_groups_at_mentions&&e.user_group_id&&e.user_group){let t=(0,H.F)(e.user_group.name)??"";n=J({userGroupId:e.user_group_id,userGroup:e.user_group,displayText:t})}else{let e=(0,A.sT)(r);t.append(e);return}t.append(n)})(t,i);else if(t.link&&(0,V.$x)((0,Z.xT)(t.link)))(function(e,t,n){if(!e.link||!(0,V.$x)((0,Z.xT)(e.link)))return;let r=(0,H.F)(e.t)??"",l=L(e.link,{editorType:n}),i=(0,A.sT)(r);ei(i,e),l.append(i),t.append(l)})(t,i,n);else if(null!=t.t){let e=(0,H.F)(t.t)??"";if((0,B.Lg)(e))(function(e,t,n){for(let r of(0,B.wd)(e)){let e="",l="";if((0,B.xM)(r)){(0,B.UF)(r).forEach(t=>{e+=t.unicode,l+=t.meta});let t=F(e,l);n.append(t)}else{let e=(0,A.sT)(r);ei(e,t),n.append(e)}}})(e,t,i);else{let n=(0,A.sT)(e);ei(n,t),i.append(n),e.endsWith("\n")&&(n.setTextContent(e.slice(0,-1)),i=(0,A.lJ)(),r.append(i))}}}if((0,A.hV)(r)&&!r.getChildren().length){let e=(0,A.lJ)();r.append(e)}}(e,t,n)},{discrete:!0}),n.getEditorState()}function en(e,t){if(null!=e.t){let n=t[t.length-1];n?.t!=null&&1===Object.keys(n).length&&1===Object.keys(e).length?n.t+=e.t:t.push(e)}else t.push(e)}function er(e){return Array.isArray(e.styles)&&e.styles.includes("ul")}function el(e){return er(e)||Array.isArray(e.styles)&&e.styles.includes("ol")}function ei(e,t){if(t.styles&&t.styles.length>0)for(let n of t.styles){let t=Q[n];t&&e.toggleFormat(t)}}let es=[(0,s.o)(/((https?:\/\/(www\.)?)|(www\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/,e=>{let t=e.replace(/[-.+():%]+$/,"");return t.startsWith("http")?t:`https://${t}`})];function eo(e){return(0,V.$x)(e)&&V.oh.test(e)}function eu(e,t,n){let r=L(e,{editorType:n}),l=(0,A.sT)(t);return r.append(l),r}function ea(){let e=(0,A.vJ)();if(!(0,A.I2)(e))return null;let t=e.getNodes().filter(e=>!ef(e));if(t.length<1)return null;let n=ed(t[0]);return n&&t.every(e=>ed(e)===n)?n:null}function ed(e){return R(e)?e.getURL():R(e.getParent())?e.getParent().getURL():null}function ec(e,t,n){let r="next"===n?eg:em,l=[],i=r(e,R);for(;i&&ex(i,t);)"next"===n?l.push(i):l.unshift(i),i=r(i,R);return l}function ep(e){if(!ea())return;let t=e.getNodes(),n=t[0],r=t[t.length-1];if(!n||!r)return;let l=ed(n);if(!l)return;let i=ec(n,l,"previous"),s=ec(r,l,"next"),o=[...i,...t.map(e=>(function(e,t){if(ex(e,t))return e;let n=e?.getParent();return n&&ex(n,t)?n:null})(e,l)).filter(e=>null!==e),...s],u=o[0],a=o[o.length-1];if(!u||!a)return;let d=e.clone();d.anchor.set(u.getKey(),0,"element"),d.focus.set(a.getKey(),a.getTextContentSize?.()||0,"element"),(0,A.n1)(d)}function ef(e){return(0,A.bS)(e)||(0,I.HY)(e)||(0,I.Mz)(e)}function em(e,t){return eh(e,t,"previous")}function eg(e,t){return eh(e,t,"next")}function eh(e,t,n){let r=null,l=e;for(r=e_(l,n);!r&&l;)r=e_(l=l.getParent(),n);return r&&t(r=function e(t,n){return t&&ef(t)?e("next"===n?t.getFirstChild():t.getLastChild(),n):t}(r,n))?r:null}function e_(e,t){return e?"next"===t?e.getNextSibling():e.getPreviousSibling():null}function ex(e,t){return R(e)&&e.getURL()===t}var ey=n(371868),eb=n(909581);function ek(){let[e]=(0,ey.DF)();return(0,r.jsx)(eb.G,{editor:e})}var ev=n(873337),eC=n(873304),eT=n(130689),eE=n(442369),eI=n(705376),eA=n(209097);function eD({anchorNode:e,replacementNode:t,end:n,matchText:r,selection:l,start:i}){let s=l.anchor.offset===e.getTextContent().length;for(let l of e.splitText(i,n))l.getTextContent()===r&&(l.replace(t),t.selectEnd());s&&ew()}function ew(){let e=(0,A.vJ)();(0,A.I2)(e)&&e.insertText(" ")}var ej=n(735212);function eS(e,t=!0){setTimeout(()=>{e.focus(),t&&e.update(()=>{(0,A.Ni)().selectEnd()})},0)}var eN=n(192075),eF=n(58212);let eM=(0,A.gu)();var eO=n(821359);function eL({dispatch:e,onUpdateTextArea:t}){let[n]=(0,ey.DF)(),r=(0,l.useRef)(null);return(0,l.useEffect)(()=>n.registerUpdateListener(({editorState:n})=>{n.read(()=>{let n=(0,A.vJ)();if((0,A.I2)(n)){let l=n.anchor.getNode();if(l instanceof A.Ey){let i=l.getTextContent(),s=n.anchor.offset,o=i.substring(0,s).match(eA.n);if(o){let n=o[1];if(n!==r.current){r.current=n;let l=(0,eO.oQ)(n);l?(e(k.We(l)),t()):e(k.We(null))}}else null!==r.current&&(r.current=null,e(k.We(null)))}else null!==r.current&&(r.current=null,e(k.We(null)))}})}),[n,e,t]),null}function eR(e){return ej.sY?e.metaKey:e.ctrlKey}function eP(e,t){if((0,I.Mz)(e)){let n=e.getParent();if((0,I.HY)(n))return n.getListType()===t}let n=e.getParent();if((0,I.Mz)(n)){let e=n.getParent();if((0,I.HY)(e))return e.getListType()===t}return!1}function eq({onEscape:e,onSubmit:t,delegateEscapeHandling:n,hasTypeahead:r,submitOnEnter:i}){return function({onEscape:e,onSubmit:t,delegateEscapeHandling:n,hasTypeahead:r,submitOnEnter:i}){(function({delegateEscapeHandling:e,onEscape:t}){let[n]=(0,ey.DF)();(0,l.useEffect)(()=>e?()=>{}:n.registerCommand(A.Q$,e=>(t(),!0),A.d),[e,n,t])})({delegateEscapeHandling:n,onEscape:e}),function({hasTypeahead:e}){let[t]=(0,ey.DF)();(0,l.useEffect)(()=>(0,ej.Sd)(...[A.UD,A.bb,A.AX,A.JM].map(n=>t.registerCommand(n,eK(e),A.d))),[t,e])}({hasTypeahead:r}),function({hasTypeahead:e}){let[t]=(0,ey.DF)();(0,l.useEffect)(()=>t.registerCommand(A.OX,eK(e),A.d),[t,e])}({hasTypeahead:r}),function({onSubmit:e,submitOnEnter:t}){let[n]=(0,ey.DF)();(0,l.useEffect)(()=>n.registerCommand(A.if,r=>{if(t&&!r?.shiftKey||r&&(r.altKey||r.metaKey))return e(),r?.preventDefault(),!0;let l=(0,A.vJ)();if(!(0,A.I2)(l))return!1;if(null!==r){if((ej.pz||ej.Yw||ej.Dz)&&ej.aT)return!1;r.preventDefault()}return n.dispatchCommand(A.XK,void 0)},A.d),[n,e,t])}({onSubmit:t,submitOnEnter:i}),function(){let[e]=(0,ey.DF)();(0,l.useEffect)(()=>e.registerCommand(A.Wu,()=>{let e=(0,A.vJ)();if(!(0,A.I2)(e))return!1;let t=function(e){let t=e.anchor.getNode();return t===e.focus.getNode()?{node:t,point:e.anchor}:null}(e);if(!t)return!1;let n=function(e){let{node:t,point:n}=e;if((0,I.Mz)(t))return t;let r=t.getParent();return r&&(0,I.Mz)(r)&&0===n.offset?r:null}(t);if(!n)return!1;let r=(0,A.lJ)();if(n.replace(r,!0),0===r.getChildrenSize()){let e=(0,A.sT)("");r.append(e),e.select()}return!0},A.d),[e])}(),function(){let[e]=(0,ey.DF)(),t=(0,l.useCallback)(t=>{let{shiftKey:n,key:r}=t;return!!eR(t)&&!!n&&("x"===r?(t.preventDefault(),t.stopPropagation(),e.dispatchCommand(A.mB,"strikethrough"),!0):"8"===r?(t.preventDefault(),t.stopPropagation(),function(e){e.update(()=>{let t=(0,A.vJ)();(0,A.I2)(t)&&(eP(t.anchor.getNode(),"bullet")?e.dispatchCommand(I.uS,void 0):e.dispatchCommand(I.q7,void 0))})}(e),!0):"7"===r&&(t.preventDefault(),t.stopPropagation(),function(e){e.update(()=>{let t=(0,A.vJ)();(0,A.I2)(t)&&(eP(t.anchor.getNode(),"number")?e.dispatchCommand(I.uS,void 0):e.dispatchCommand(I.x,void 0))})}(e),!0))},[e]);(0,l.useEffect)(()=>e.registerRootListener(e=>{if(e)return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}}),[e,t])}(),function(){let[e]=(0,ey.DF)(),t=(0,l.useCallback)(t=>{eR(t)&&t.shiftKey&&"u"===t.key&&(t.stopPropagation(),e.dispatchCommand(eM,void 0))},[e]);(0,l.useEffect)(()=>e.registerRootListener(e=>{if(e)return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}}),[e,t])}(),function(){let[e]=(0,ey.DF)();(0,l.useEffect)(()=>e.registerRootListener(e=>{if(e){let t=e=>{"Escape"!==e.key&&"Backspace"!==e.key&&e.stopPropagation()};return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}}}),[e])}()}({onEscape:e,onSubmit:t,delegateEscapeHandling:n,hasTypeahead:r,submitOnEnter:i}),null}function eK(e){return t=>(t.stopPropagation(),!!e()&&(t.preventDefault(),!0))}var eU=n(666875),eJ=n(944350);function eW({contactsAnalytics:e,dispatch:t,onUpdateTextArea:n,mentionables:r,isProtoView:i,figmaEditorType:s}){let[o]=(0,ey.DF)(),u=(0,l.useRef)(null),a=(0,l.useRef)(null),[d]=(0,eU.A)(async l=>{let o=(async e=>{a.current&&a.current.cancel(),a.current=new eI.qm;try{return{result:await (0,eI.t8)((0,eO.fG)(e,r,!i&&s===eJ._Y.DESIGN),a.current),canceled:!1}}catch(e){if(e instanceof eI.cJ)return{result:null,canceled:!0};throw e}})(l);(0,h.Lg)()&&(window.TEST_ONLY_mentionsSearchPending=o);let{result:u,canceled:d}=await o;d||(u?(e.trackQueryResult(u.query,u.mentions.length),t(k.We(u))):t(k.We({type:"mentions",mentions:[],index:0,maxMentions:0,search:l,query:l})),n())},300),c=(0,l.useRef)(d);return c.current=d,(0,l.useEffect)(()=>o.registerUpdateListener(({editorState:e})=>{e.read(()=>{let e=(0,A.vJ)();if((0,A.I2)(e)){let n=e.anchor.getNode();if(n instanceof A.Ey){let r=n.getTextContent(),l=e.anchor.offset,i=r.substring(0,l),s=(0,eI.uT)(i);if(s){let{search:e}=s;e!==u.current&&(u.current=e,c.current(e))}else null!==u.current&&(u.current=null,a.current&&a.current.cancel(),t(k.We(null)))}else null!==u.current&&(u.current=null,a.current&&a.current.cancel(),t(k.We(null)))}})}),[o,t]),null}function eG({contactsAnalytics:e,delegateEscapeHandling:t,dispatch:n,editingComment:i,editorOnClear:s,editorOnInsert:o,editorRef:u,editorType:a,figmaEditorType:d,hasTypeahead:c,isProtoView:p,isThreadCommentOverflowMenuOpen:f,maintainSelectionOnFocus:m,mentionables:g,onCancel:h,onFocus:_,onSubmit:x,onUpdateTextArea:y,setHyperlinkEditorRef:C,setHyperlinkLocation:T,setIsEditorFocused:E,submitOnEnter:I,typeahead:D}){let w=(0,l.useRef)(D);w.current=D;let{insertEmoji:j,insertMention:S,clearTypeahead:N,selectAll:M}=function({contactsAnalytics:e,dispatch:t}){let[n]=(0,ey.DF)(),r=(0,l.useCallback)(e=>{let r=()=>{n.update(()=>{let t=(0,A.vJ)()??(0,A.S1)();if(!(0,A.I2)(t))return;let n=t.anchor.getNode(),r=eC.il.getDefaultSkin(),l=r?`:skin-tone-${r}:`:"";e.skins.length<2&&(l="");let i=`:${e.id}:${l}`,s=(0,B.UF)(i);if(!s||s.length<1)return;let o=F(s[0].unicode,i);if(n instanceof A.Ey){let e=n.getTextContent(),r=t.focus.offset,l=e.substring(0,r).match(eA.n);if(l){let e=l.index;eD({anchorNode:n,replacementNode:o,end:r,matchText:l[0],selection:t,start:e});return}}let u=t.anchor.offset===n.getTextContent().length;t.insertNodes([o]),u&&ew()}),t(k.We(null))};n.getEditorState().read(()=>(0,A.vJ)())?r():n.focus(r)},[t,n]);return{insertEmoji:r,insertMention:function(e,t,n){let r=(0,P.kc)().user_groups_at_mentions;return(0,l.useCallback)((l,i)=>{n.trackResultClicked(i.query,i.index,i.mentions.length,!1),(0,eE.r)(i.query,i,!0),e.update(()=>{let e=(0,A.vJ)()??(0,A.S1)();if(!(0,A.I2)(e))return;let t=e.anchor.getNode(),n="profile_handle"in l,i=(0,v.dH)(l),s=n||i?void 0:l.id,o=n?l.id:void 0,u=n||i?void 0:l,a=i&&r?l.id:void 0,d=i&&r?l:void 0,c=J({displayText:n?`@${l.profile_handle}`:i?l.name:(0,H.F)(l.handle)??l.id,userId:s,profileId:o,userAnnotated:u,userGroupId:a,userGroup:d});if(t instanceof A.Ey){let n=t.getTextContent(),r=e.focus.offset,l=n.substring(0,r),i=(0,eI.uT)(l);if(i){let n=i.index;eD({anchorNode:t,replacementNode:c,end:r,matchText:`@${i.search}`,selection:e,start:n});return}}e.insertNodes([c]),c.selectEnd()}),"profile_handle"in l&&t((0,eT.Hx)(l)),t(k.We(null))},[n,t,e,r])}(n,t,e),clearTypeahead:(0,l.useCallback)(n=>{e.endSession(n),t(k.We(null))},[e,t]),selectAll:(0,l.useCallback)(()=>{n.focus(()=>{n.update(()=>{let e=(0,A.vJ)();(0,A.I2)(e)&&(0,ev.e1)(e)})})},[n])}}({contactsAnalytics:e,dispatch:n}),O=function(){let[e]=(0,ey.DF)();return(0,l.useCallback)(()=>e.getEditorState().read(()=>{let e=(0,A.vJ)();if(!(0,A.I2)(e))return!1;let{anchor:t,focus:n}=e,r=e.isBackward(),l=r?n:t,i=r?t:n,s=(0,A.Ni)(),o=function(e,t){let n=e.getFirstDescendant(),r=e.getFirstChild();return n?.getKey()===t?n:r?.getKey()===t?r:null}(s,l.key),u=function(e,t){let n=e.getLastDescendant(),r=e.getLastChild();return n?.getKey()===t?n:r?.getKey()===t?r:null}(s,i.key);return!!o&&!!u&&0===l.offset&&i.offset===((0,A.ff)(u)?u.getChildrenSize():u.getTextContentSize())}),[e])}(),L=function({editingComment:e,editorType:t,hasTypeahead:n,isThreadCommentOverflowMenuOpen:r,onCancel:i}){let s=!r&&!(e&&"comment-editor-reply"===t);return(0,l.useCallback)(()=>{!n()&&s&&i()},[s,n,i])}({editingComment:i,editorType:a,hasTypeahead:c,isThreadCommentOverflowMenuOpen:f,onCancel:h}),{hasFocus:q,handleOnFocus:K,focus:U}=function({contactsAnalytics:e,maintainSelectionOnFocus:t=!1,onFocus:n,setIsEditorFocused:r,typeaheadRef:i}){let[s]=(0,ey.DF)(),o=(0,l.useRef)(!1),u=(0,l.useCallback)(()=>o.current,[]),a=(0,l.useCallback)(()=>(o.current=!0,r(o.current),n(),!1),[n,r]),d=(0,l.useCallback)(()=>{eS(s,!t)},[s,t]),c=(0,l.useCallback)((e=!0)=>{u()||eS(s,e)},[s,u]),p=(0,l.useCallback)(()=>{o.current=!1,r(o.current);let t=i.current;return t?.type==="mentions"&&t.mentions[t.index]&&(e.endSession("input_blurred"),(0,eE.r)(t.query,t,!1)),!1},[e,r,i]);return(0,l.useLayoutEffect)(()=>(o.current=s.getRootElement()===document.activeElement,(0,ej.Sd)(s.registerCommand(A.$7,a,A.Ac),s.registerCommand(A.pF,p,A.Ac))),[s,p,a]),{hasFocus:u,handleOnFocus:d,handleOnBlur:p,focus:c}}({contactsAnalytics:e,maintainSelectionOnFocus:m,onFocus:_,setIsEditorFocused:E,typeaheadRef:w});!function({setHyperlinkLocation:e,setHyperlinkEditorRef:t,editorRef:n}){let[r]=(0,ey.DF)();(0,l.useEffect)(()=>n&&e&&t?r.registerCommand(eM,()=>(r.update(()=>{let r=(0,A.vJ)();(0,A.I2)(r)&&ep(r);let l=(0,Y.L5)();l&&(e(l),t(n))}),!0),A.d):()=>{},[r,n,t,e])}({setHyperlinkLocation:T,setHyperlinkEditorRef:C,editorRef:u});let W=function({dispatch:e,editorType:t}){let[n]=(0,ey.DF)();return(0,l.useCallback)(r=>{let l=(0,Z.xT)(r);if(!(0,V.$x)(l)){e(eF.F.enqueue({message:(0,eN.t)("hyperlink.invalid_link_plain")}));return}n.update(()=>{!function(e,t){let n=(0,A.vJ)();if(!(0,A.I2)(n))return;if(n.isCollapsed()){let r=eu(e,e,t);n.insertNodes([r]);return}let r=new Set;n.getNodes().forEach(e=>{if((0,A.kF)(e)){let t=e.getParent();R(t)?r.add(t):r.add(e)}else R(e)&&r.add(e)});let l=Array.from(r),i=n.anchor,s=n.focus;for(let n=0;n<l.length;n++){let r=l[n];if((0,A.kF)(r)){let o,u;1===l.length?(o=Math.min(i.offset,s.offset),u=Math.max(i.offset,s.offset)):0===n?(o=i.key===r.getKey()?i.offset:s.offset,u=void 0):n===l.length-1&&(o=0,u=i.key===r.getKey()?i.offset:s.offset),function(e,t,n,r,l){let i=e.getTextContent(),s=r??0,o=l??i.length,u=i.slice(0,s),a=i.slice(s,o),d=i.slice(o),c=[];u&&c.push((0,A.sT)(u)),a&&c.push(eu(t,a,n)),d&&c.push((0,A.sT)(d));let[p,...f]=c;p&&(e.replace(p),f.reduce((e,t)=>(t.insertAfter(e),t),p))}(r,e,t,o,u)}else R(r)&&r.setURL(e)}}(l,t)})},[e,n,t])}({dispatch:n,editorType:a}),G=function(){let[e]=(0,ey.DF)();return(0,l.useCallback)(()=>e.read(()=>ea()??""),[e])}(),$=function(){let[e]=(0,ey.DF)();return(0,l.useCallback)(()=>{e.update(()=>{!function(){if(!ea())return;let e=A.vJ()?.getNodes().filter(R);e?.forEach(e=>{!function(e){let t=e.getTextContent(),n=(0,A.sT)(t),r=(0,A.vJ)();e.replace(n),(0,A.I2)(r)&&n.select()}(e)})}()})},[e])}(),X=function({dispatch:e,setHyperlinkLocation:t,setHyperlinkEditorRef:n,editorRef:r}){let[i]=(0,ey.DF)();return(0,l.useCallback)((l,s)=>{t&&n&&r&&(e((0,b.jD)()),i.update(()=>{let e=(0,A.ns)(l);if(!R(e))return;e.select();let i=(0,A.vJ)();(0,A.I2)(i)&&ep(i),s&&(t(s),n(r))}))},[e,i,r,n,t])}({dispatch:n,setHyperlinkLocation:T,setHyperlinkEditorRef:C,editorRef:u});(0,l.useImperativeHandle)(u,()=>({onFocus:K,focus:U,selectAll:M,onSubmitHyperlink:W,onRemoveHyperlink:$,getActiveHyperlinkForCurrentSelection:G,editHyperlinkFromTooltip:X,handleEscape:L,hasFocus:q,isAllSelected:O,insertEmoji:j}),[X,U,G,L,K,$,W,q,j,O,M]);let z=(0,l.useCallback)(()=>{let e=w.current;if(e){if("emojis"===e.type){let t=e.emojis[e.index];t&&j(t)}else if("mentions"===e.type){let t=e.mentions[e.index];t&&S(t,e)}}},[j,S]);return(0,l.useEffect)(()=>{o(z),s(()=>N("editor_clear"))},[N,o,s,z]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eL,{dispatch:n,onUpdateTextArea:y}),(0,r.jsx)(eW,{contactsAnalytics:e,dispatch:n,onUpdateTextArea:y,mentionables:g,isProtoView:p,figmaEditorType:d}),(0,r.jsx)(eq,{onEscape:L,onSubmit:x,delegateEscapeHandling:t,hasTypeahead:c,submitOnEnter:I})]})}function e$(){let[e]=(0,ey.DF)();return(0,l.useEffect)(()=>e.registerNodeTransform(A.Ey,e=>{let t=e.getTextContent(),n=(function(e,t){let n=e.getTextContent(),r=n;if((0,A.I2)(t)&&t.anchor.getNode()===e){let e=t.anchor.offset;r=n.substring(0,e)}return r})(e,(0,A.vJ)()).match(eA.v);if(!n)return;let r=n[0],l=n.index,i=l+r.length;if(!(0,B.xM)(r))return;let s=(0,B.UF)(r);if(null==s||0===s.length)return;let o=F(s[0].unicode,r);switch(function({startOffset:e,endOffset:t,textContent:n}){return 0===e&&t===n.length?"all":0===e?"start":t===n.length?"end":"middle"}({startOffset:l,endOffset:i,textContent:t})){case"all":e.replace(o);break;case"start":{let n=t.slice(i),r=(0,A.sT)(n);e.insertAfter(r),e.replace(o);break}case"end":{let n=t.slice(0,l),r=(0,A.sT)(n);e.insertBefore(r);let i=(0,A.sT)(" ");e.insertAfter(i),e.replace(o),i.select();break}case"middle":{let n=t.slice(0,l),r=t.slice(i),s=(0,A.sT)(n),u=(0,A.sT)(r);e.insertBefore(s),e.insertAfter(u),e.replace(o)}}}),[e]),null}var eX=n(832937);function ez({onFilePaste:e}){let[t]=(0,ey.DF)();return(0,l.useEffect)(()=>t.registerCommand(A.w,t=>{let[,n,r]=(0,eX.gA)(t);return n.length>0&&!r&&(e(n),!0)},A.Ac),[t,e]),null}function eB({initMention:e}){let[t]=(0,ey.DF)(),n=(0,l.useRef)();return(0,l.useEffect)(()=>{let r=n.current;e&&!r&&t.update(()=>{let e=(0,A.vJ)();(0,A.I2)(e)&&e.insertText("@")}),n.current=e},[t,e]),null}function eH({maxLength:e}){let[t]=(0,ey.DF)();return(0,l.useEffect)(()=>{let n=null;return t.registerNodeTransform(A.h,r=>{let l=(0,A.vJ)();if(!(0,A.I2)(l)||!l.isCollapsed())return;let i=t.getEditorState(),s=i.read(()=>r.getTextContentSize()),o=r.getTextContentSize();if(s!==o){let r=o-e,u=l.anchor;r>0&&(s===e&&n!==i?(n=i,(0,ej.Xq)(t,i)):(0,ev._A)(t,u,r))}})},[t,e]),null}var eZ=n(666388);function eY({messageMeta:e,editorType:t}){let[n]=(0,ey.DF)(),r=(0,y.ZC)(e);return l.useEffect(()=>{if(r&&!(0,eZ.Wf)(e,r)){let r=ee(n.getEditorState());if(!(0,eZ.Wf)(r,e)){let r=et(e,t);n.setEditorState(r),n.focus()}}},[n,e,r,t]),null}var eV=n(292811);function eQ({focusStart:e,shouldAutoFocus:t}){return t?(0,r.jsx)(eV.x,{defaultSelection:e?"rootStart":"rootEnd"}):null}function e0(){let[e]=(0,ey.DF)();return(0,l.useEffect)(()=>(window.lexicalEditor=e,()=>{delete window.lexicalEditor}),[e]),null}var e1=n(725694),e2=n(901144);let e7=[e1.d7,e1.Pi,e1.Eg,e1.gW,e1.NB,e1.mK,e1.WY];function e5(){return(0,r.jsx)(e2.E,{transformers:e7})}let e6=l.forwardRef(function(e,t){let{ariaLabel:n,className:g,currentOrgId:_,currentOrgUsers:E,delegateEscapeHandling:I,dispatch:D,editingComment:j,editorOnClear:S,editorOnInsert:N,editorRef:F,editorType:M,figmaEditorType:O,initMention:L,isProtoView:R,isThreadCommentOverflowMenuOpen:P,maintainSelectionOnFocus:q,maxCommentLength:K,mentionables:U,messageMeta:J,mountInputFocused:W,moveFocusToStartOnMount:G,onCancel:X,onFilePaste:z,onFocus:B,onSubmit:H,onUpdateTextArea:Z,openFileKey:Y,openFileTeamId:V,placeholderText:Q,readOnly:en,setHyperlinkEditorRef:er,setHyperlinkLocation:el,setIsEditorFocused:ei,showDebugger:eu,submitOnEnter:ea,tabIndex:ed,typeahead:ec,updateMessage:ep,user:ef}=e,em=function({messageMeta:e,editorType:t,editable:n}){let[r]=(0,l.useState)(()=>et(e,t));return(0,l.useMemo)(()=>$({editorState:r,editorType:t,editable:n}),[n,t,r])}({messageMeta:J,editorType:M,editable:!en}),eg=function({currentOrgId:e,currentOrgUsers:t,openFileKey:n,openFileTeamId:r,user:i}){return(0,l.useMemo)(()=>{let l=(0,C.Ty)(e??null,i??null,t),s=(0,C.pP)(e,r,l);return new C.yO(C.I2,n,s,e,r,"lexical")},[e,t,n,r,i])}({currentOrgId:_,currentOrgUsers:E,openFileKey:Y,openFileTeamId:V,user:ef}),eh=function(){let[e]=(0,l.useState)(()=>{let e=["onMouseDown"];return T.eD||e.push("onContextMenu"),e});return e}(),e_=(0,y.ZC)(ec),ex=l.useRef(ec);ex.current=ec;let ey=(0,l.useCallback)(()=>!!ex.current,[]);return(0,l.useEffect)(()=>{F&&M&&D(b.pP({targetKey:M,targetRef:F}))},[D,F,M]),(0,l.useEffect)(()=>{e_||ec?.type!=="mentions"||D((0,k.Qe)())},[e_,ec,D]),(0,r.jsx)("div",{className:x()(w.DX,g||w.DL),"data-testid":"editable-typeahead",children:(0,r.jsx)(i.o,{eventListeners:eh,children:(0,r.jsxs)(o.n,{initialConfig:em,children:[(0,r.jsx)(d.G,{}),(0,r.jsx)(m.$,{contentEditable:(0,r.jsx)("div",{className:"x1n2onr6",children:(0,r.jsx)(u.a,{"aria-haspopup":"listbox","aria-placeholder":Q??"",ariaActiveDescendant:ec?.type==="mentions"?e.activeMentionsId:void 0,ariaControls:ec?.type==="mentions"?v.Qd:void 0,ariaExpanded:ec?.type==="mentions",ariaLabel:n??Q,placeholder:(0,r.jsx)("span",{className:"x3vvef7 x10l6tqk x13vifvy xu96u03 x47corl",children:Q}),role:"combobox",tabIndex:ed})}),ErrorBoundary:a.A}),(0,r.jsx)(f.D,{onChange:e=>{ep([ee(e),e.read(()=>{let e=(0,A.vJ)();if(!(0,A.I2)(e))return!1;let t=(0,A.Ni)(),n=t.getChildren();if(0===n.length)return!1;let r=n[n.length-1],l=n.length>1?n[n.length-2]:null,i=e.getNodes()[e.getNodes().length-1]??e.focus.getNode();for(;i&&i.getParent()!==t;)i=i.getParent();return i===r||null!=l&&i===l})])}}),(0,r.jsx)(eQ,{focusStart:!!G,shouldAutoFocus:!!W}),(0,r.jsx)(eY,{messageMeta:J,editorType:M}),(0,r.jsx)(eB,{initMention:L}),null!=K&&K>0&&(0,r.jsx)(eH,{maxLength:K}),(0,r.jsx)(e$,{}),null!=z&&(0,r.jsx)(ez,{onFilePaste:z}),(0,r.jsx)(eG,{contactsAnalytics:eg,delegateEscapeHandling:I,dispatch:D,editingComment:j,editorOnClear:S,editorOnInsert:N,editorRef:F,editorType:M,figmaEditorType:O,hasTypeahead:ey,isProtoView:R,isThreadCommentOverflowMenuOpen:P,maintainSelectionOnFocus:q,mentionables:U,onCancel:X,onFocus:B,onSubmit:H,onUpdateTextArea:Z,setHyperlinkEditorRef:er,setHyperlinkLocation:el,setIsEditorFocused:ei,submitOnEnter:ea,typeahead:ec}),(0,r.jsx)(s.p,{matchers:es}),(0,r.jsx)(c.W,{validateUrl:eo}),(0,r.jsx)(e5,{}),(0,r.jsx)(p.Q,{}),eu&&(0,r.jsx)(ek,{}),(0,h.Lg)()&&(0,r.jsx)(e0,{})]})})})})},157869:(e,t,n)=>{n.d(t,{n:()=>d});var r=n(104076),l=n(674524),i=n(511570),s=n.n(i),o=n(652539),u=n(349311);let a="file_upload_icon_input--disabledIcon--JLhI1";function d(e){let{svg:t,svgAltText:n,isDisabled:i,acceptedFileTypes:d,inputRef:c,onFileInputChange:p,singleFile:f,recordingKey:m}=e,g=(0,l.AF)(m,"change",e=>{p(c)()});return(0,r.jsxs)("label",{htmlFor:e.inputId,className:s()("file_upload_icon_input--fileUploadIconLabel--GkBse",{[a]:i}),"data-tooltip-type":u.Ib.TEXT,"data-tooltip-show-immediately":!0,"data-tooltip":i?null:e["data-tooltip"],children:[(0,r.jsx)("input",{ref:c,accept:d,"aria-label":e["data-tooltip"],className:"file_upload_icon_input--fileInput--qwRav",disabled:i,id:e.inputId,multiple:!f,name:e.inputId,onChange:g,type:"file"}),e.children||t&&(0,r.jsx)("div",{className:"file_upload_icon_input--svg--qwaj3",children:(0,r.jsx)(o.B,{title:n,ariaLabel:n,svg:t,autosize:!0,className:s()({[a]:i})})})]})}}}]);

//# debugId=d28fd0bb-8c92-5e43-b9f0-4110b9184ab1

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/f695da755526e966524d3a207f8e1d2f4d77a41b/9787-4c60aa2887ab4741.min.js.map